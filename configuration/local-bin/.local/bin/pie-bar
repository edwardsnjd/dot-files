#!/usr/bin/env bash

# Pie bar
# Usage: pie-bar value1 value2 ...
# Dependencies: tput, awk

function Main() {
  local total="$(Total "$@")"

  local ind=0
  local cols="${COLS:-$(tput cols)}"

  while [[ $# -gt 0 ]]; do
    local val=$1
    shift

    local char=$(PickCharacter $ind $val)

    local width=$(( $cols * $val / $total ))
    if [[ $width -gt 0 ]]; then
      seq 1 $width | while read; do printf "$char"; done
    fi

    ind=$(( $ind + 1 ))
  done
  printf "\n"
}

function Total() {
  echo "$@" | tr ' ' '\n' | awk '{t+=$1} END {print t}'
}

function PickCharacter() {
  local chars="▢▣▤▥▦▧▨▩"
  local colors="1234567"
  local char_index=$(( ($2 - $1) % ${#chars} ))
  local color_index=$(( (3 * $1 + $2) % ${#colors} ))
  printf "$(tput setaf ${colors:$color_index:1})${chars:$char_index:1}$(tput sgr0)"
}

Main "$@"
